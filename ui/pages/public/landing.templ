package pages

import (
	"SchoolScienceHelper/ui/components/button"
	"SchoolScienceHelper/ui/components/card"
	"SchoolScienceHelper/ui/layouts"
)

templ Landing(auth0Domain string, auth0ClientID string) {
	@layouts.BaseLayout() {
		<main class="flex flex-col min-h-[calc(100vh-72px)] bg-background text-foreground px-6 py-20 space-y-24">
			<!-- Hero Section -->
			<section class="flex flex-col items-center text-center">
				<h1 class="text-5xl md:text-6xl font-black text-primary mb-6 leading-tight">
					Welcome to SchoolScienceHelper
				</h1>
				<p class="max-w-2xl text-lg text-muted-foreground leading-relaxed mb-10">
					Your all-in-one platform for science revision, quizzes, and learning. Empowering students and teachers to master science, together!
				</p>
				<div class="flex flex-wrap justify-center gap-6">
					@button.Button(button.Props{
						Variant: "outline",
						Href:    "https://github.com/KdntNinja/SchoolScienceHelper",
						Target:  "_blank",
					}) {
						View on GitHub
					}
					@button.Button(button.Props{
						Variant: "secondary",
						ID:      "get-started-btn",
						Type:    "button",
					}) {
						Get Started
					}
				</div>
				<script>
					document.addEventListener('DOMContentLoaded', function() {
						// --- Auth0 callback handling ---
						const hash = window.location.hash;
						if (hash && (hash.includes('id_token') || hash.includes('access_token'))) {
							const params = new URLSearchParams(hash.substring(1));
							const idToken = params.get('id_token');
							if (idToken) {
								// Send token to backend to set cookie
								fetch('/api/auth/callback', {
									method: 'POST',
									headers: { 'Content-Type': 'application/json' },
									body: JSON.stringify({ token: idToken })
								})
								.then(res => {
									if (res.ok) {
										window.location.replace('/dash');
									} else {
										alert('Authentication failed.');
									}
								});
								return;
							}
						}

						const btn = document.getElementById('get-started-btn');
						btn.onclick = function(e) {
							e.preventDefault();
							// Auth0 config injected from Go backend
							const domain = "{{auth0Domain}}";
							const clientId = "{{auth0ClientID}}";
							if (!domain || !clientId) {
								alert('Auth0 configuration is missing.');
								return;
							}
							const redirectUri = window.location.origin + '/'; // Use / as the callback
							const nonce = Date.now();
							window.location.href = `https://${domain}/authorize?response_type=id_token%20token&client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=openid%20profile%20email&nonce=${nonce}`;
						};
						// If already authenticated, redirect to /dash
						fetch('/api/auth/check', { credentials: 'include' }).then(r => r.json()).then(data => {
							if (data && data.authenticated) {
								window.location.replace('/dash');
							}
						});
					});
				</script>
			</section>
			<!-- Features Section -->
			<section class="max-w-5xl mx-auto text-center">
				<h2 class="text-3xl font-bold mb-6 text-primary">Why SchoolScienceHelper?</h2>
				<div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-left">
					@card.Card(card.Props{Class: "p-6 bg-card rounded-xl shadow border border-border"}) {
						<h3 class="text-xl font-semibold mb-2">ğŸ§ª Interactive Science Quizzes</h3>
						<p class="text-muted-foreground">
							Test your knowledge with engaging, curriculum-aligned quizzes for Biology, Chemistry, and Physics.
						</p>
					}
					@card.Card(card.Props{Class: "p-6 bg-card rounded-xl shadow border border-border"}) {
						<h3 class="text-xl font-semibold mb-2">ğŸ“š Revision Resources</h3>
						<p class="text-muted-foreground">
							Access concise revision notes, diagrams, and flashcards to boost your science grades.
						</p>
					}
					@card.Card(card.Props{Class: "p-6 bg-card rounded-xl shadow border border-border"}) {
						<h3 class="text-xl font-semibold mb-2">ğŸ‘©â€ğŸ« Teacher Tools</h3>
						<p class="text-muted-foreground">
							Track student progress, assign quizzes, and support learning in and out of the classroom.
						</p>
					}
				</div>
			</section>
			<!-- Footer -->
			<footer class="text-sm text-muted-foreground text-center pt-10 border-t border-border">
				Have questions or want to get involved? Join the
				<a
					href="https://SchoolScienceHelper/discussions"
					target="_blank"
					class="text-primary hover:underline ml-1"
				>
					GitHub Discussions
				</a> ğŸ’¬ â€” or follow us for updates!
			</footer>
		</main>
	}
}
